#include<stdio.h>
#include<stdlib.h>

#define DEFINE_ZED_TYPE(type_) typedef type_ ZED##type_;typedef type_ * type_##P;typedef type_##P ZED##type_##P;static type_##P type_##ArrayNew(ull size){return (type_##P)malloc(size*sizeof(type_));}

typedef unsigned long long ull;
typedef unsigned char u;
DEFINE_ZED_TYPE(u)
typedef uP p;
typedef union{ull length;p pointer;}g;
DEFINE_ZED_TYPE(g)
typedef gP pp;
pp gl;

ull ullMax(ull one,ull two)
{
  if(one>two)
  {
    return one;
  }
  else
  {
    return two;
  }
}

ull extent1(ull character)
{
  return character-'0';
}

ull extent2(ull index,p list,ull value)
{
  if(list[index]==')')
  {
    return value;
  }
  else
  {
    return extent2(index+1,list,extent1(list[index])+value*10);
  }
}

ull extent(p list)
{
  return extent2(1,list,0);
}

ull selfExtent1(ull extent,ull length,ull magnitude)
{
  if(extent<magnitude)
  {
    return length;
  }
  else
  {
    return selfExtent1(extent,length+1,magnitude*10);
  }
}

ull selfExtent(ull extent)
{
  return selfExtent1(extent,3,10);
}

void display1(ull index,ull end,p list)
{
  if(index<end)
  {
    printf("%c",list[index]);
    display1(index+1,end,list);
  }
}

void display(p list)
{
  ull ext=extent(list);
  ull start=selfExtent(ext);
  ull end=start+ext;
  display1(start,end,list);
}

void line()
{
  printf("\n");
}

void space()
{
  printf(" ");
}

void displayLine(p list)
{
  display(list);
  line();
}

void displaySpace(p list)
{
  display(list);
  space();
}

ull stringLength1(char* string,ull index)
{
  if(string[index]==0)
  {
    return index;
  }
  else
  {
    return stringLength1(string,index+1);
  }
}

ull stringLength(char* string)
{
  return stringLength1(string,0);
}

u ullAssertLargePowerOfTwo1(ull number,ull t)
{
  if(t>number)
  {
    return 0;
  }
  else if(t==number)
  {
    return 1;
  }
  else
  {
    return ullAssertLargePowerOfTwo1(number,t*2);
  }
}

u ullAssertLargePowerOfTwo(ull number)
{
  return ullAssertLargePowerOfTwo1(number,1024);
}

pp glNew()
{
  pp garbage=gArrayNew(1024);
  garbage[1023].length=0;
  return garbage+1023;
}

pp glExtend(p garbage,pp gl)
{
  ull i;
  ull count=0;
  ull length=gl[0].length;
  for(i=1;i<length+1;++i)
  {
    if(gl[i].pointer==garbage)
    {
      ++count;
    }
  }
  if(count==0)
  {
    if(ullAssertLargePowerOfTwo(gl[0].length+1))
    {
      pp temp=gArrayNew(2*(length+1));
      temp=temp+length;
      temp[0].length=length+1;
      temp[1].pointer=garbage;
      ull right=length+1;
      for(i=2;i<right;++i)
      {
        temp[i].pointer=gl[i-1].pointer;
      }
      free(gl);
      return temp;
      }
      else
      {
        gl=gl-1;
        gl[0].length=length+1;
        gl[1].pointer=garbage;
        return gl;
      }
  }
  else
  {
    return gl;
  }
}

pp co1(pp gl,ull t)
{
  if(t-1<gl[0].length)
  {
    return co1(gl,t*2);
  }
  else
  {
    return gl-(t-1-gl[0].length);
  }
}

void co()
{
  ull right=gl[0].length;
  ull i;
  for(i=right;i>0;--i)
  {
    free(gl[i].pointer);
  }
  gl=co1(gl,1024);
  free(gl);
  gl=glNew();
}

p n1(char* string,p list,ull left,ull right,ull extent)
{
  list[0]='(';
  list[left-1]=')';
  ull i;
  for(i=left-2;i>0;--i)
  {
    list[i]=(u)extent%10+'0';
    extent/=10;
  }
  for(i=left;i<right;++i)
  {
    list[i]=(u)string[i-left];
  }
  return list;
}

p n(char* string)
{
  ull x=stringLength(string);
  ull s=selfExtent(x);
  ull t=s+x;
  return n1(string,uArrayNew(t),s,t,x);
}

void cc(p list)
{
  gl=glExtend(list,gl);
}

p c1(p list,p temp,ull length)
{
  if(length==0)
  {
    return temp;
  }
  else
  {
    temp[length-1]=list[length-1];
    return c1(list,temp,length-1);
  }
}

p c(p list)
{
  ull x=extent(list);
  ull s=selfExtent(x);
  ull length=s+x;
  p temp=uArrayNew(length);
  return c1(list,temp,length);
}

p ap1(p one,p two,p three,ull s1,ull s2,ull left,ull middle,ull right,ull extent)
{
  co();
  ull i;
  three[0]='(';three[left-1]=')';
  for(i=left-2;i>0;--i)
  {
    three[i]=extent%10+'0';
    extent=extent/10;
  }
  for(i=left;i<middle;++i)
  {
    three[i]=one[i-left+s1];
  }
  for(i=middle;i<right;++i)
  {
    three[i]=two[i-middle+s2];
  }
  cc(one);
  cc(two);
  cc(three);
  return c(three);
}

p ap(p one,p two)
{
  co();
  ull x1=extent(one);
  ull x2=extent(two);
  ull x3=x1+x2;
  ull s1=selfExtent(x1);
  ull s2=selfExtent(x2);
  ull s3=selfExtent(x3);
  ull t=s3+x3;
  cc(one);
  cc(two);
  return ap1(c(one),c(two),uArrayNew(t),s1,s2,s3,s3+x1,t,x3);
}

p ad1(p one,p two,ull s1,ull t1,ull s2,ull t2,ull carry)
{
  co();
  if(t1<s1)
  {
    if(carry)
    {
      cc(one);
      cc(two);
      return ap(n("1"),c(one));
    }
    else
    {
      cc(one);
      cc(two);
      return c(one);
    }
  }
  else if(t2<s2)
  {
    ull temp=one[t1];
    one[t1]=(temp-'0'+carry)%10+'0';
    if((temp-'0'+carry)>9)
    {
      cc(one);
      cc(two);
      return ad1(c(one),c(two),s1,t1-1,s2,t2,1);
    }
    else
    {
      cc(one);
      cc(two);
      return c(one);
    }
  }
  else
  {
    ull temp=one[t1];
    one[t1]=(temp-'0'+two[t2]-'0'+carry)%10+'0';
    cc(one);
    cc(two);
    return ad1(c(one),c(two),s1,t1-1,s2,t2-1,(temp-'0'+two[t2]-'0'+carry)/10);
  }
}

p ad(p one,p two)
{
  co();
  ull x1=extent(one);
  ull x2=extent(two);
  ull x3=ullMax(x1,x2);
  ull s1=selfExtent(x1);
  ull s2=selfExtent(x2);
  ull t1=s1+x1;
  ull t2=s2+x2;
  if(x3==x1)
  {
    cc(one);
    cc(two);
    return ad1(c(one),c(two),s1,t1-1,s2,t2-1,0);
  }
  else
  {
    cc(one);
    cc(two);
    return ad1(c(two),c(one),s2,t2-1,s1,t1-1,0);
  }
}

p al(p one,p two)
{
  co();
  ull x1=extent(one);
  ull x2=extent(two);
  ull s1=selfExtent(x1);
  ull s2=selfExtent(x2);
  ull t1=s1+x1;
  ull t2=s2+x2;
  while(one[s1]==two[s2]&&s1<t1&&s2<t2)
  {
    ++s1;
    ++s2;
  }
  if(s1<t1&&s2<t2)
  {
    cc(one);
    cc(two);
    return (one[s1]<two[s2])?c(one):n("#fals");
  }
  else
  {
    cc(one);
    cc(two);
    return (x1<x2)?c(one):n("#fals");
  }
}

p lt(p one,p two)
{
  co();
  ull x1=extent(one);
  ull x2=extent(two);
  if(x1==x2)
  {
    ull s=selfExtent(x1);
    ull t=s+x1;
    while(one[s]==two[s]&&s<t)
    {
      ++s;
    }
    if(s<t)
    {
      cc(one);
      cc(two);
      return (one[s]<two[s])?c(one):n("#fals");
    }
    else
    {
      cc(one);
      cc(two);
      return n("#fals");
    }
  }
  else
  {
    cc(one);
    cc(two);
    return (x1<x2)?c(one):n("#fals");
  }
}

p eq(p one,p two)
{
  co();
  ull x1=extent(one);
  ull x2=extent(two);
  if(x1==x2)
  {
    ull s=selfExtent(x1);
    ull t=s+x1;
    while(s<t&&one[s]==two[s])
    {
      ++s;
    }
    if(s==t)
    {
      cc(one);
      cc(two);
      return c(one);
    }
  }
  return n("#fals");
}

p gt(p one,p two)
{
  co();
  ull x1=extent(one);
  ull x2=extent(two);
  if(x1==x2)
  {
    ull s=selfExtent(x1);
    ull t=s+x1;
    while(one[s]==two[s]&&s<t)
    {
      ++s;
    }
    if(s<t)
    {
      cc(one);
      cc(two);
      return (one[s]>two[s])?c(one):n("#fals");
    }
    else
    {
      cc(one);
      cc(two);
      return n("#fals");
    }
  }
  else
  {
    cc(one);
    cc(two);
    return (x1>x2)?c(one):n("#fals");
  }
}

p nu(p list)
{
  co();
  cc(list);
  return (extent(list)==0)?c(list):n("#fals");
}

u assert(p list)
{
  co();
  ull x=extent(list);
  cc(list);
  return !(x==5&&list[3]=='#'&&list[4]=='f'&&list[5]=='a'&&list[6]=='l'&&list[7]=='s')&&!(x==6&&list[3]=='#'&&list[4]=='f'&&list[5]=='a'&&list[6]=='l'&&list[7]=='s'&&list[8]=='e');
}

u assertValue(p list)
{
  co();
  ull x=extent(list);
  cc(list);
  return !(x==5&&list[3]=='#'&&list[4]=='f'&&list[5]=='a'&&list[6]=='l'&&list[7]=='s');
}

p no(p one)
{
  co();
  if(assert(one))
  {
    cc(one);
    return n("#fals");
  }
  else
  {
    cc(one);
    return n("#true");
  }
}

p a(p one,p two)
{
  co();
  if(assert(one))
  {
    cc(one);
    cc(two);
    return c(two);
  }
  else
  {
    cc(one);
    cc(two);
    return c(one);
  }
}

p o(p one,p two)
{
  co();
  if(assert(one))
  {
    cc(one);
    cc(two);
    return c(one);
  }
  else
  {
    cc(one);
    cc(two);
    return c(two);
  }
}

p x(p one,p two)
{
  co();
  if(assert(one))
  {
    cc(one);
    cc(two);
    return no(c(two));
  }
  else
  {
    cc(one);
    cc(two);
    return c(two);
  }
}

p push1(p one,p two,p three,ull left,ull middle,ull right,ull total)
{
  co();
  three[0]='(';three[left-1]=')';
  ull i;
  for(i=left-2;i>0;--i)
  {
    three[i]=total%10+'0';
    total/=10;
  }
  for(i=left;i<middle;++i)
  {
    three[i]=one[i-left];
  }
  for(i=middle;i<right;++i)
  {
    three[i]=two[i-middle];
  }
  cc(one);
  cc(two);
  cc(three);
  return c(three);
}

p push(p one,p two)
{
  co();
  ull x1=extent(one);
  ull x2=extent(two);
  ull s1=selfExtent(x1);
  ull s2=selfExtent(x2);
  ull t1=s1+x1;
  ull x3=t1+s2+x2;
  ull s3=selfExtent(x3);
  ull x4=s3+x3;
  cc(one);
  cc(two);
  return push1(c(one),c(two),uArrayNew(x4),s3,s3+t1,x4,x3);
}

p top(p list)
{
  co();
  ull x=extent(list);
  ull s=selfExtent(x);
  cc(list);
  return c(list+s);
}

p pop(p list)
{
  co();
  ull x=extent(list);
  ull s=selfExtent(x);
  ull tx=extent(list+s);
  ull ts=selfExtent(tx);
  cc(list);
  return c(list+s+ts+tx);
}

int main()
{
gl=glNew();
p num=n("999876543217654321600543215432143210321211112304567892345678093456789045678956789678978098999999");
displayLine(lt(c(num),c(num)));
printf("%d\n",assertValue(lt(c(num),c(num))));
displayLine(gt(c(num),c(num)));
printf("%d\n",assertValue(gt(c(num),c(num))));
displayLine(eq(c(num),c(num)));
printf("%d\n",assertValue(eq(c(num),c(num))));
displayLine(al(n("123"),n("999")));
printf("%d\n",assertValue(al(n("123"),n("999"))));
displayLine(al(n("#false"),n("#true")));
printf("%d\n",assertValue(al(n("#false"),n("#true"))));
line();
displayLine(ap(c(num),c(num)));
line();
p list=push(c(num),n(""));
displayLine(c(list));
line();
pop(c(list));
displayLine(top(c(list)));
line();
displayLine(ad(c(num),c(num)));
line();
displayLine(a(n("#fals"),n("#false")));
line();
displayLine(a(n("#fals"),c(num)));
line();
displayLine(a(n("#true"),n("#false")));
line();
displayLine(a(n("#true"),c(num)));
line();
displayLine(o(n("#fals"),n("#false")));
line();
displayLine(o(n("#fals"),c(num)));
line();
displayLine(o(n("#true"),n("#false")));
line();
displayLine(o(n("#true"),c(num)));
line();
displayLine(x(n("#fals"),n("#false")));
line();
displayLine(x(n("#fals"),c(num)));
line();
displayLine(x(n("#true"),n("#false")));
line();
displayLine(x(n("#true"),c(num)));
line();
displayLine(a(eq(push(n("one"),n("two")),push(n("one"),n("two"))),n("success")));
line();
//displayLine(rd(&o,n("#false"),push(n("#false"),push(n("first"),push(n("second"),n(""))))));
line();
printf("\n%llu\n",gl[0].length);
co();
printf("\n%llu\n",gl[0].length);
return 0;
}
